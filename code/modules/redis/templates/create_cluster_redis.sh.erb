#!/usr/bin/env bash

redisHosts="<%= @redis_create_cluster_hosts %>"

redisClusterHost=(${redisHosts//:6379/ })

COUNT=$(expr ${#redisClusterHost[@]} / 2)

a=0
        until [ ! $a -lt $COUNT ]
        do
                ping -c 1 ${redisClusterHost[$a]} > /dev/null
                if [ "$?" -ne 0 ]; then
                  output="Not Enough hosts"
                fi
        a=$(expr $a + 1)
        done

        redis-cli -h 127.0.0.1 -p 6379 cluster nodes | grep slave > /dev/null
        return_code2=$?
                if [ "$return_code2" -ne 0 ]; then
                          outputClusterCreation="Cluster not created"
                fi

        if [ "$output" = "Not Enough hosts" ] || [ "$outputClusterCreation" != "Cluster not created" ]; then
                exit -1
        fi

